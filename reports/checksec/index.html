<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checksec Report</title>

    <style>
        body {
            font-family: system-ui, sans-serif;
            background: #f6f6f6;
            padding: 20px;
        }

        h1 {
            margin-top: 0;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            background: white;
        }

        th, td {
            padding: 6px 10px;
            border: 1px solid #ddd;
            font-size: 14px;
        }

        th {
            background: #eee;
            position: sticky;
            top: 0;
        }

        tr.good { background: #e8f5e9; }
        tr.warn { background: #fff8e1; }
        tr.bad  { background: #fdecea; }

        .filter {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

<h1>Binary Hardening Report (checksec)</h1>

<table id="table">
    <thead></thead>
    <tbody></tbody>
</table>

<script>
    const headers = [
        "RELRO",
        "STACK CANARY",
        "NX",
        "PIE",
        "RPATH",
        "RUNPATH",
        "Symbols",
        "FORTIFY",
        "Fortified",
        "Fortifiable",
        "FILE"
    ];

    fetch("checksec.csv")
        .then(r => r.text())
        .then(text => {
            const lines = text.trim().split("\n");

            // Parse CSV rows safely
            const rows = lines.map(l =>
                l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g,""))
            );

            const thead = document.querySelector("#table thead");
            thead.innerHTML =
                "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";

            const tbody = document.querySelector("#table tbody");

            function severity(row) {
                const NX = row[headers.indexOf("NX")];
                const CANARY = row[headers.indexOf("STACK CANARY")];
                const RELRO = row[headers.indexOf("RELRO")];

                if (!NX || NX.includes("disabled")) return "bad";
                if (!CANARY || CANARY.includes("No canary")) return "warn";
                if (!RELRO || RELRO.includes("Partial")) return "warn";
                return "good";
            }

            tbody.innerHTML = "";
            rows.forEach(r => {
                const tr = document.createElement("tr");
                tr.className = severity(r);
                tr.innerHTML = r.map(c => `<td>${c}</td>`).join("");
                tbody.appendChild(tr);
            });
        });
</script>



</body>
</html>
